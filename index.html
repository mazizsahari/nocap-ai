<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake Content Detector</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 4rem 0;
            color: white;
            border-radius: 0 0 30px 30px;
        }
        .main-container {
            margin-top: -2rem;
        }
        .analysis-card {
            box-shadow: 0 8px 24px rgba(149, 157, 165, 0.2);
            border-radius: 1rem;
            border: none;
        }
        #result-card {
            transition: all 0.3s ease-in-out;
        }
        .verdict-badge {
            font-size: 1.1rem;
            font-weight: 600;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
        }
        .verdict-badge-real {
            background-color: #d1e7dd;
            color: #0f5132;
        }
        .verdict-badge-misleading {
            background-color: #fff3cd;
            color: #664d03;
        }
        .verdict-badge-fake {
            background-color: #f8d7da;
            color: #842029;
        }
        .source-link {
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        .spinner-border {
             width: 3rem;
             height: 3rem;
        }
        .api-key-label {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">
                ðŸ§¢ NoCap AI
            </a>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="hero-section text-center">
        <div class="container">
            <h1 class="display-5 fw-bold">Detect Fake Content with AI</h1>
            <p class="lead">Analyze URLs, news articles, and websites to uncover misinformation and potential threats.</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container main-container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card analysis-card p-3 p-md-4">
                    <div class="card-body">
                        <h5 class="card-title text-center mb-3">Enter Content to Analyze</h5>
                        <p class="card-text text-muted text-center mb-4">Paste a URL or a snippet of text below. Our AI will analyze it for authenticity using real-time information.</p>
                        
                        <!-- Input Form -->
                        <div class="form-group mb-3">
                            <label for="api-key-input" class="form-label fw-medium">Your Gemini API Key 
                                <i class="bi bi-info-circle-fill text-primary api-key-label" data-bs-toggle="modal" data-bs-target="#apiKeyModal"></i>
                            </label>
                            <input type="password" id="api-key-input" class="form-control" placeholder="Enter your API key here">
                        </div>
                        <div class="form-group mb-3">
                             <label for="content-input" class="form-label fw-medium">Content to Analyze</label>
                            <textarea id="content-input" class="form-control" rows="5" placeholder="e.g., https://example.com or 'A news headline...'"></textarea>
                        </div>
                        <div class="d-grid">
                            <button id="analyze-btn" class="btn btn-primary btn-lg">
                                <span id="btn-text">Analyze Content</span>
                                <span id="btn-spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="result-section" class="mt-4 d-none">
                    <div id="result-card" class="card analysis-card">
                        <div class="card-header bg-white border-0 pt-3">
                            <h5 class="card-title text-center mb-0">Analysis Result</h5>
                        </div>
                        <div class="card-body text-center">
                            <!-- Loading Spinner -->
                            <div id="loading-spinner" class="d-flex justify-content-center align-items-center py-5 d-none">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="ms-3 mb-0 fs-5 text-muted">Analyzing...</p>
                            </div>
                            
                            <!-- Analysis Content -->
                            <div id="analysis-content">
                                <div class="mb-4">
                                    <span id="verdict-badge" class="verdict-badge"></span>
                                </div>
                                <div id="reasoning-text" class="text-start"></div>
                                <hr class="my-4">
                                <div id="sources-section" class="d-none">
                                    <h6 class="text-start fw-bold mb-3">Sources Found:</h6>
                                    <div id="sources-list" class="list-group text-start"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- API Key Instructions Modal -->
    <div class="modal fade" id="apiKeyModal" tabindex="-1" aria-labelledby="apiKeyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="apiKeyModalLabel">How to Get Your Google Gemini API Key</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>To use this tool, you need a free API key from Google AI Studio. Follow these steps:</p>
                    <ol>
                        <li>Go to the Google AI Studio website: <a href="https://aistudio.google.com/" target="_blank">https://aistudio.google.com/</a></li>
                        <li>Sign in with your Google account.</li>
                        <li>Click on the <strong>"Get API key"</strong> button, which you can usually find on the top left of the page.</li>
                        <li>Click on <strong>"Create API key in new project"</strong>.</li>
                        <li>A new API key will be generated for you. Copy the entire key.</li>
                        <li>Close this window and paste the copied key into the "Your Gemini API Key" input box on the main page.</li>
                    </ol>
                    <p class="text-muted small"><strong>Important:</strong> Your API key is for your personal use. Keep it secure and do not share it publicly.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-muted py-4 mt-5">
        <div class="container">
            <p>&copy; 2025 Powered By ðŸ§¢ NoCap AI.</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- Main Application Logic -->
    <script>
        const analyzeBtn = document.getElementById('analyze-btn');
        const btnText = document.getElementById('btn-text');
        const btnSpinner = document.getElementById('btn-spinner');
        const apiKeyInput = document.getElementById('api-key-input');
        const contentInput = document.getElementById('content-input');
        const resultSection = document.getElementById('result-section');
        const loadingSpinner = document.getElementById('loading-spinner');
        const analysisContent = document.getElementById('analysis-content');
        const verdictBadge = document.getElementById('verdict-badge');
        const reasoningText = document.getElementById('reasoning-text');
        const sourcesSection = document.getElementById('sources-section');
        const sourcesList = document.getElementById('sources-list');

        analyzeBtn.addEventListener('click', handleAnalysis);

        async function handleAnalysis() {
            const userApiKey = apiKeyInput.value.trim();
            const userInput = contentInput.value.trim();

            if (!userApiKey) {
                alert("Please enter your Gemini API key.");
                return;
            }
            if (!userInput) {
                alert("Please enter a URL or text to analyze.");
                return;
            }

            setLoadingState(true);

            const systemPrompt = `
                You are an expert fact-checker and digital security analyst named NoCap AI. 
                Your task is to analyze the provided URL or text content and determine its authenticity.
                Look for signs of phishing, misinformation, fake news, or malicious intent. 
                Provide a clear, one-word verdict from the following options: 'Likely Real', 'Potentially Misleading', or 'Likely Fake'.
                Then, provide a concise, bullet-pointed explanation for your reasoning.
                Format your response as follows:
                Verdict: [Your Verdict]

                Reasoning:
                - [Point 1]
                - [Point 2]
                - [Point 3]...
            `;
            
            const userQuery = `Please analyze the following content: ${userInput}`;
            
            try {
                const result = await callGeminiApi(userQuery, systemPrompt, userApiKey);
                displayResult(result);
            } catch (error) {
                console.error("Error during analysis:", error);
                displayError("An error occurred during analysis. Check your API key and the console for details.");
            } finally {
                setLoadingState(false);
            }
        }

        async function callGeminiApi(userQuery, systemPrompt, apiKey, retries = 3, delay = 1000) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };
            
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}: ${await response.text()}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const text = candidate.content.parts[0].text;
                        
                        let sources = [];
                        const groundingMetadata = candidate.groundingMetadata;
                        if (groundingMetadata && groundingMetadata.groundingAttributions) {
                            sources = groundingMetadata.groundingAttributions
                                .map(attribution => ({
                                    uri: attribution.web?.uri,
                                    title: attribution.web?.title,
                                }))
                                .filter(source => source.uri && source.title);
                        }
                        
                        return { text, sources };
                    } else if (result.error) {
                        throw new Error(`API Error: ${result.error.message}`);
                    } else {
                        throw new Error("Invalid response structure from API.");
                    }
                } catch (error) {
                    console.log(`Attempt ${i + 1} failed. Retrying in ${delay * Math.pow(2, i)}ms...`);
                    if (i === retries - 1) throw error;
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
        }
        
        function displayResult({ text, sources }) {
            // Parse the text from Gemini
            const lines = text.split('\n');
            let verdict = 'Analysis';
            let reasoning = '';

            const verdictLine = lines.find(line => line.toLowerCase().startsWith('verdict:'));
            if (verdictLine) {
                verdict = verdictLine.substring('verdict:'.length).trim();
            }
            
            const reasoningIndex = lines.findIndex(line => line.toLowerCase().startsWith('reasoning:'));
            if (reasoningIndex !== -1) {
                reasoning = lines.slice(reasoningIndex + 1).join('\n').trim();
            } else {
                 reasoning = text;
            }

            // Update UI elements
            verdictBadge.textContent = verdict;
            verdictBadge.className = 'verdict-badge'; // Reset classes
            if (verdict.toLowerCase().includes('real')) {
                verdictBadge.classList.add('verdict-badge-real');
            } else if (verdict.toLowerCase().includes('misleading')) {
                verdictBadge.classList.add('verdict-badge-misleading');
            } else if (verdict.toLowerCase().includes('fake')) {
                verdictBadge.classList.add('verdict-badge-fake');
            }
            
            // Format reasoning with list groups for better visuals
            const reasoningPoints = reasoning.split('- ').filter(p => p.trim() !== '');
            reasoningText.innerHTML = reasoningPoints.map(point => `<p class="mb-2"><strong>â€¢</strong> ${point.trim()}</p>`).join('');

            // Display sources
            if (sources && sources.length > 0) {
                sourcesList.innerHTML = sources.map(source => 
                    `<a href="${source.uri}" target="_blank" rel="noopener noreferrer" class="list-group-item list-group-item-action">
                        <div class="fw-bold">${source.title}</div>
                        <small class="text-muted source-link">${source.uri}</small>
                    </a>`
                ).join('');
                sourcesSection.classList.remove('d-none');
            } else {
                sourcesSection.classList.add('d-none');
            }
        }
        
        function displayError(message) {
            verdictBadge.textContent = 'Error';
            verdictBadge.className = 'verdict-badge verdict-badge-fake';
            reasoningText.innerHTML = `<p>${message}</p>`;
            sourcesSection.classList.add('d-none');
        }

        function setLoadingState(isLoading) {
            if (isLoading) {
                btnText.classList.add('d-none');
                btnSpinner.classList.remove('d-none');
                analyzeBtn.disabled = true;
                resultSection.classList.remove('d-none');
                loadingSpinner.classList.remove('d-none');
                analysisContent.classList.add('d-none');
            } else {
                btnText.classList.remove('d-none');
                btnSpinner.classList.add('d-none');
                analyzeBtn.disabled = false;
                loadingSpinner.classList.add('d-none');
                analysisContent.classList.remove('d-none');
            }
        }

    </script>
</body>
</html>

